{"remainingRequest":"F:\\College\\毕业论文\\cityAnalysis-master\\frontend\\node_modules\\babel-loader\\lib\\index.js!F:\\College\\毕业论文\\cityAnalysis-master\\frontend\\src\\components\\FaceView\\MovingMarker.js","dependencies":[{"path":"F:\\College\\毕业论文\\cityAnalysis-master\\frontend\\src\\components\\FaceView\\MovingMarker.js","mtime":1642779265605},{"path":"F:\\College\\毕业论文\\cityAnalysis-master\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\College\\毕业论文\\cityAnalysis-master\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:TC5pbnRlcnBvbGF0ZVBvc2l0aW9uID0gZnVuY3Rpb24gKHAxLCBwMiwgZHVyYXRpb24sIHQpIHsKICB2YXIgayA9IHQgLyBkdXJhdGlvbjsKICBrID0gayA+IDAgPyBrIDogMDsKICBrID0gayA+IDEgPyAxIDogazsKICByZXR1cm4gTC5sYXRMbmcocDEubGF0ICsgayAqIChwMi5sYXQgLSBwMS5sYXQpLCBwMS5sbmcgKyBrICogKHAyLmxuZyAtIHAxLmxuZykpOwp9OwoKTC5NYXJrZXIuTW92aW5nTWFya2VyID0gTC5NYXJrZXIuZXh0ZW5kKHsKICAvL3N0YXRlIGNvbnN0YW50cwogIHN0YXRpY3M6IHsKICAgIG5vdFN0YXJ0ZWRTdGF0ZTogMCwKICAgIGVuZGVkU3RhdGU6IDEsCiAgICBwYXVzZWRTdGF0ZTogMiwKICAgIHJ1blN0YXRlOiAzCiAgfSwKICBvcHRpb25zOiB7CiAgICBhdXRvc3RhcnQ6IGZhbHNlLAogICAgbG9vcDogZmFsc2UKICB9LAogIGluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRsbmdzLCBkdXJhdGlvbnMsIG9wdGlvbnMpIHsKICAgIEwuTWFya2VyLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgbGF0bG5nc1swXSwgb3B0aW9ucyk7CiAgICB0aGlzLl9sYXRsbmdzID0gbGF0bG5ncy5tYXAoZnVuY3Rpb24gKGUsIGluZGV4KSB7CiAgICAgIHJldHVybiBMLmxhdExuZyhlKTsKICAgIH0pOwoKICAgIGlmIChkdXJhdGlvbnMgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICB0aGlzLl9kdXJhdGlvbnMgPSBkdXJhdGlvbnM7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9kdXJhdGlvbnMgPSB0aGlzLl9jcmVhdGVEdXJhdGlvbnModGhpcy5fbGF0bG5ncywgZHVyYXRpb25zKTsKICAgIH0KCiAgICB0aGlzLl9jdXJyZW50RHVyYXRpb24gPSAwOwogICAgdGhpcy5fY3VycmVudEluZGV4ID0gMDsKICAgIHRoaXMuX3N0YXRlID0gTC5NYXJrZXIuTW92aW5nTWFya2VyLm5vdFN0YXJ0ZWRTdGF0ZTsKICAgIHRoaXMuX3N0YXJ0VGltZSA9IDA7CiAgICB0aGlzLl9zdGFydFRpbWVTdGFtcCA9IDA7IC8vIHRpbWVzdGFtcCBnaXZlbiBieSByZXF1ZXN0QW5pbUZyYW1lCgogICAgdGhpcy5fcGF1c2VTdGFydFRpbWUgPSAwOwogICAgdGhpcy5fYW5pbUlkID0gMDsKICAgIHRoaXMuX2FuaW1SZXF1ZXN0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2N1cnJlbnRMaW5lID0gW107CiAgICB0aGlzLl9zdGF0aW9ucyA9IHt9OwogIH0sCiAgaXNSdW5uaW5nOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5fc3RhdGUgPT09IEwuTWFya2VyLk1vdmluZ01hcmtlci5ydW5TdGF0ZTsKICB9LAogIGlzRW5kZWQ6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLl9zdGF0ZSA9PT0gTC5NYXJrZXIuTW92aW5nTWFya2VyLmVuZGVkU3RhdGU7CiAgfSwKICBpc1N0YXJ0ZWQ6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLl9zdGF0ZSAhPT0gTC5NYXJrZXIuTW92aW5nTWFya2VyLm5vdFN0YXJ0ZWRTdGF0ZTsKICB9LAogIGlzUGF1c2VkOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5fc3RhdGUgPT09IEwuTWFya2VyLk1vdmluZ01hcmtlci5wYXVzZWRTdGF0ZTsKICB9LAogIHN0YXJ0OiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5pc1J1bm5pbmcoKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHRoaXMuaXNQYXVzZWQoKSkgewogICAgICB0aGlzLnJlc3VtZSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fbG9hZExpbmUoMCk7CgogICAgICB0aGlzLl9zdGFydEFuaW1hdGlvbigpOwoKICAgICAgdGhpcy5maXJlKCdzdGFydCcpOwogICAgfQogIH0sCiAgcmVzdW1lOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuaXNQYXVzZWQoKSkgewogICAgICByZXR1cm47CiAgICB9IC8vIHVwZGF0ZSB0aGUgY3VycmVudCBsaW5lCgoKICAgIHRoaXMuX2N1cnJlbnRMaW5lWzBdID0gdGhpcy5nZXRMYXRMbmcoKTsKICAgIHRoaXMuX2N1cnJlbnREdXJhdGlvbiAtPSB0aGlzLl9wYXVzZVN0YXJ0VGltZSAtIHRoaXMuX3N0YXJ0VGltZTsKCiAgICB0aGlzLl9zdGFydEFuaW1hdGlvbigpOwogIH0sCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5pc1J1bm5pbmcoKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5fcGF1c2VTdGFydFRpbWUgPSBEYXRlLm5vdygpOwogICAgdGhpcy5fc3RhdGUgPSBMLk1hcmtlci5Nb3ZpbmdNYXJrZXIucGF1c2VkU3RhdGU7CgogICAgdGhpcy5fc3RvcEFuaW1hdGlvbigpOwoKICAgIHRoaXMuX3VwZGF0ZVBvc2l0aW9uKCk7CiAgfSwKICBzdG9wOiBmdW5jdGlvbiAoZWxhcHNlZFRpbWUpIHsKICAgIGlmICh0aGlzLmlzRW5kZWQoKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5fc3RvcEFuaW1hdGlvbigpOwoKICAgIGlmICh0eXBlb2YgZWxhcHNlZFRpbWUgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIC8vIHVzZXIgY2FsbAogICAgICBlbGFwc2VkVGltZSA9IDA7CgogICAgICB0aGlzLl91cGRhdGVQb3NpdGlvbigpOwogICAgfQoKICAgIHRoaXMuX3N0YXRlID0gTC5NYXJrZXIuTW92aW5nTWFya2VyLmVuZGVkU3RhdGU7CiAgICB0aGlzLmZpcmUoJ2VuZCcsIHsKICAgICAgZWxhcHNlZFRpbWU6IGVsYXBzZWRUaW1lCiAgICB9KTsKICB9LAogIGFkZExhdExuZzogZnVuY3Rpb24gKGxhdGxuZywgZHVyYXRpb24pIHsKICAgIHRoaXMuX2xhdGxuZ3MucHVzaChMLmxhdExuZyhsYXRsbmcpKTsKCiAgICB0aGlzLl9kdXJhdGlvbnMucHVzaChkdXJhdGlvbik7CiAgfSwKICBtb3ZlVG86IGZ1bmN0aW9uIChsYXRsbmcsIGR1cmF0aW9uKSB7CiAgICB0aGlzLl9zdG9wQW5pbWF0aW9uKCk7CgogICAgdGhpcy5fbGF0bG5ncyA9IFt0aGlzLmdldExhdExuZygpLCBMLmxhdExuZyhsYXRsbmcpXTsKICAgIHRoaXMuX2R1cmF0aW9ucyA9IFtkdXJhdGlvbl07CiAgICB0aGlzLl9zdGF0ZSA9IEwuTWFya2VyLk1vdmluZ01hcmtlci5ub3RTdGFydGVkU3RhdGU7CiAgICB0aGlzLnN0YXJ0KCk7CiAgICB0aGlzLm9wdGlvbnMubG9vcCA9IGZhbHNlOwogIH0sCiAgYWRkU3RhdGlvbjogZnVuY3Rpb24gKHBvaW50SW5kZXgsIGR1cmF0aW9uKSB7CiAgICBpZiAocG9pbnRJbmRleCA+IHRoaXMuX2xhdGxuZ3MubGVuZ3RoIC0gMiB8fCBwb2ludEluZGV4IDwgMSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5fc3RhdGlvbnNbcG9pbnRJbmRleF0gPSBkdXJhdGlvbjsKICB9LAogIG9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CiAgICBMLk1hcmtlci5wcm90b3R5cGUub25BZGQuY2FsbCh0aGlzLCBtYXApOwoKICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b3N0YXJ0ICYmICF0aGlzLmlzU3RhcnRlZCgpKSB7CiAgICAgIHRoaXMuc3RhcnQoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICh0aGlzLmlzUnVubmluZygpKSB7CiAgICAgIHRoaXMuX3Jlc3VtZUFuaW1hdGlvbigpOwogICAgfQogIH0sCiAgb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHsKICAgIEwuTWFya2VyLnByb3RvdHlwZS5vblJlbW92ZS5jYWxsKHRoaXMsIG1hcCk7CgogICAgdGhpcy5fc3RvcEFuaW1hdGlvbigpOwogIH0sCiAgX2NyZWF0ZUR1cmF0aW9uczogZnVuY3Rpb24gKGxhdGxuZ3MsIGR1cmF0aW9uKSB7CiAgICB2YXIgbGFzdEluZGV4ID0gbGF0bG5ncy5sZW5ndGggLSAxOwogICAgdmFyIGRpc3RhbmNlcyA9IFtdOwogICAgdmFyIHRvdGFsRGlzdGFuY2UgPSAwOwogICAgdmFyIGRpc3RhbmNlID0gMDsgLy8gY29tcHV0ZSBhcnJheSBvZiBkaXN0YW5jZXMgYmV0d2VlbiBwb2ludHMKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxhc3RJbmRleDsgaSsrKSB7CiAgICAgIGRpc3RhbmNlID0gbGF0bG5nc1tpICsgMV0uZGlzdGFuY2VUbyhsYXRsbmdzW2ldKTsKICAgICAgZGlzdGFuY2VzLnB1c2goZGlzdGFuY2UpOwogICAgICB0b3RhbERpc3RhbmNlICs9IGRpc3RhbmNlOwogICAgfQoKICAgIHZhciByYXRpb0R1cmF0aW9uID0gZHVyYXRpb24gLyB0b3RhbERpc3RhbmNlOwogICAgdmFyIGR1cmF0aW9ucyA9IFtdOwoKICAgIGZvciAoaSA9IDA7IGkgPCBkaXN0YW5jZXMubGVuZ3RoOyBpKyspIHsKICAgICAgZHVyYXRpb25zLnB1c2goZGlzdGFuY2VzW2ldICogcmF0aW9EdXJhdGlvbik7CiAgICB9CgogICAgcmV0dXJuIGR1cmF0aW9uczsKICB9LAogIF9zdGFydEFuaW1hdGlvbjogZnVuY3Rpb24gKCkgewogICAgdGhpcy5fc3RhdGUgPSBMLk1hcmtlci5Nb3ZpbmdNYXJrZXIucnVuU3RhdGU7CiAgICB0aGlzLl9hbmltSWQgPSBMLlV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAodGltZXN0YW1wKSB7CiAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgIHRoaXMuX3N0YXJ0VGltZVN0YW1wID0gdGltZXN0YW1wOwoKICAgICAgdGhpcy5fYW5pbWF0ZSh0aW1lc3RhbXApOwogICAgfSwgdGhpcywgdHJ1ZSk7CiAgICB0aGlzLl9hbmltUmVxdWVzdGVkID0gdHJ1ZTsKICB9LAogIF9yZXN1bWVBbmltYXRpb246IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5fYW5pbVJlcXVlc3RlZCkgewogICAgICB0aGlzLl9hbmltUmVxdWVzdGVkID0gdHJ1ZTsKICAgICAgdGhpcy5fYW5pbUlkID0gTC5VdGlsLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKHRpbWVzdGFtcCkgewogICAgICAgIHRoaXMuX2FuaW1hdGUodGltZXN0YW1wKTsKICAgICAgfSwgdGhpcywgdHJ1ZSk7CiAgICB9CiAgfSwKICBfc3RvcEFuaW1hdGlvbjogZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuX2FuaW1SZXF1ZXN0ZWQpIHsKICAgICAgTC5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltSWQpOwogICAgICB0aGlzLl9hbmltUmVxdWVzdGVkID0gZmFsc2U7CiAgICB9CiAgfSwKICBfdXBkYXRlUG9zaXRpb246IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbGFwc2VkVGltZSA9IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWU7CgogICAgdGhpcy5fYW5pbWF0ZSh0aGlzLl9zdGFydFRpbWVTdGFtcCArIGVsYXBzZWRUaW1lLCB0cnVlKTsKICB9LAogIF9sb2FkTGluZTogZnVuY3Rpb24gKGluZGV4KSB7CiAgICB0aGlzLl9jdXJyZW50SW5kZXggPSBpbmRleDsKICAgIHRoaXMuX2N1cnJlbnREdXJhdGlvbiA9IHRoaXMuX2R1cmF0aW9uc1tpbmRleF07CiAgICB0aGlzLl9jdXJyZW50TGluZSA9IHRoaXMuX2xhdGxuZ3Muc2xpY2UoaW5kZXgsIGluZGV4ICsgMik7CiAgfSwKCiAgLyoqCiAgICogTG9hZCB0aGUgbGluZSB3aGVyZSB0aGUgbWFya2VyIGlzCiAgICogQHBhcmFtICB7TnVtYmVyfSB0aW1lc3RhbXAKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGVsYXBzZWQgdGltZSBvbiB0aGUgY3VycmVudCBsaW5lIG9yIG51bGwgaWYKICAgKiB3ZSByZWFjaGVkIHRoZSBlbmQgb3IgbWFya2VyIGlzIGF0IGEgc3RhdGlvbgogICAqLwogIF91cGRhdGVMaW5lOiBmdW5jdGlvbiAodGltZXN0YW1wKSB7CiAgICAvLyB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGxhc3QgbGF0bG5nCiAgICB2YXIgZWxhcHNlZFRpbWUgPSB0aW1lc3RhbXAgLSB0aGlzLl9zdGFydFRpbWVTdGFtcDsgLy8gbm90IGVub3VnaCB0aW1lIHRvIHVwZGF0ZSB0aGUgbGluZQoKICAgIGlmIChlbGFwc2VkVGltZSA8PSB0aGlzLl9jdXJyZW50RHVyYXRpb24pIHsKICAgICAgcmV0dXJuIGVsYXBzZWRUaW1lOwogICAgfQoKICAgIHZhciBsaW5lSW5kZXggPSB0aGlzLl9jdXJyZW50SW5kZXg7CiAgICB2YXIgbGluZUR1cmF0aW9uID0gdGhpcy5fY3VycmVudER1cmF0aW9uOwogICAgdmFyIHN0YXRpb25EdXJhdGlvbjsKCiAgICB3aGlsZSAoZWxhcHNlZFRpbWUgPiBsaW5lRHVyYXRpb24pIHsKICAgICAgLy8gc3Vic3RyYWN0IHRpbWUgb2YgdGhlIGN1cnJlbnQgbGluZQogICAgICBlbGFwc2VkVGltZSAtPSBsaW5lRHVyYXRpb247CiAgICAgIHN0YXRpb25EdXJhdGlvbiA9IHRoaXMuX3N0YXRpb25zW2xpbmVJbmRleCArIDFdOyAvLyB0ZXN0IGlmIHRoZXJlIGlzIGEgc3RhdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lCgogICAgICBpZiAoc3RhdGlvbkR1cmF0aW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoZWxhcHNlZFRpbWUgPCBzdGF0aW9uRHVyYXRpb24pIHsKICAgICAgICAgIHRoaXMuc2V0TGF0TG5nKHRoaXMuX2xhdGxuZ3NbbGluZUluZGV4ICsgMV0pOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBlbGFwc2VkVGltZSAtPSBzdGF0aW9uRHVyYXRpb247CiAgICAgIH0KCiAgICAgIGxpbmVJbmRleCsrOyAvLyB0ZXN0IGlmIHdlIGhhdmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBwb2x5bGluZQoKICAgICAgaWYgKGxpbmVJbmRleCA+PSB0aGlzLl9sYXRsbmdzLmxlbmd0aCAtIDEpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvb3ApIHsKICAgICAgICAgIGxpbmVJbmRleCA9IDA7CiAgICAgICAgICB0aGlzLmZpcmUoJ2xvb3AnLCB7CiAgICAgICAgICAgIGVsYXBzZWRUaW1lOiBlbGFwc2VkVGltZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIHBsYWNlIHRoZSBtYXJrZXIgYXQgdGhlIGVuZCwgZWxzZSBpdCB3b3VsZCBiZSBhdAogICAgICAgICAgLy8gdGhlIGxhc3QgcG9zaXRpb24KICAgICAgICAgIHRoaXMuc2V0TGF0TG5nKHRoaXMuX2xhdGxuZ3NbdGhpcy5fbGF0bG5ncy5sZW5ndGggLSAxXSk7CiAgICAgICAgICB0aGlzLnN0b3AoZWxhcHNlZFRpbWUpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CgogICAgICBsaW5lRHVyYXRpb24gPSB0aGlzLl9kdXJhdGlvbnNbbGluZUluZGV4XTsKICAgIH0KCiAgICB0aGlzLl9sb2FkTGluZShsaW5lSW5kZXgpOwoKICAgIHRoaXMuX3N0YXJ0VGltZVN0YW1wID0gdGltZXN0YW1wIC0gZWxhcHNlZFRpbWU7CiAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpIC0gZWxhcHNlZFRpbWU7CiAgICByZXR1cm4gZWxhcHNlZFRpbWU7CiAgfSwKICBfYW5pbWF0ZTogZnVuY3Rpb24gKHRpbWVzdGFtcCwgbm9SZXF1ZXN0QW5pbSkgewogICAgdGhpcy5fYW5pbVJlcXVlc3RlZCA9IGZhbHNlOyAvLyBmaW5kIHRoZSBuZXh0IGxpbmUgYW5kIGNvbXB1dGUgdGhlIG5ldyBlbGFwc2VkVGltZQoKICAgIHZhciBlbGFwc2VkVGltZSA9IHRoaXMuX3VwZGF0ZUxpbmUodGltZXN0YW1wKTsKCiAgICBpZiAodGhpcy5pc0VuZGVkKCkpIHsKICAgICAgLy8gbm8gbmVlZCB0byBhbmltYXRlCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoZWxhcHNlZFRpbWUgIT0gbnVsbCkgewogICAgICAvLyBjb21wdXRlIHRoZSBwb3NpdGlvbgogICAgICB2YXIgcCA9IEwuaW50ZXJwb2xhdGVQb3NpdGlvbih0aGlzLl9jdXJyZW50TGluZVswXSwgdGhpcy5fY3VycmVudExpbmVbMV0sIHRoaXMuX2N1cnJlbnREdXJhdGlvbiwgZWxhcHNlZFRpbWUpOwogICAgICB0aGlzLnNldExhdExuZyhwKTsKICAgIH0KCiAgICBpZiAoIW5vUmVxdWVzdEFuaW0pIHsKICAgICAgdGhpcy5fYW5pbUlkID0gTC5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fYW5pbWF0ZSwgdGhpcywgZmFsc2UpOwogICAgICB0aGlzLl9hbmltUmVxdWVzdGVkID0gdHJ1ZTsKICAgIH0KICB9Cn0pOwoKTC5NYXJrZXIubW92aW5nTWFya2VyID0gZnVuY3Rpb24gKGxhdGxuZ3MsIGR1cmF0aW9uLCBvcHRpb25zKSB7CiAgcmV0dXJuIG5ldyBMLk1hcmtlci5Nb3ZpbmdNYXJrZXIobGF0bG5ncywgZHVyYXRpb24sIG9wdGlvbnMpOwp9Ow=="},{"version":3,"sources":["F:/College/毕业论文/cityAnalysis-master/frontend/src/components/FaceView/MovingMarker.js"],"names":["L","interpolatePosition","p1","p2","duration","t","k","latLng","lat","lng","Marker","MovingMarker","extend","statics","notStartedState","endedState","pausedState","runState","options","autostart","loop","initialize","latlngs","durations","prototype","call","_latlngs","map","e","index","Array","_durations","_createDurations","_currentDuration","_currentIndex","_state","_startTime","_startTimeStamp","_pauseStartTime","_animId","_animRequested","_currentLine","_stations","isRunning","isEnded","isStarted","isPaused","start","resume","_loadLine","_startAnimation","fire","getLatLng","pause","Date","now","_stopAnimation","_updatePosition","stop","elapsedTime","addLatLng","latlng","push","moveTo","addStation","pointIndex","length","onAdd","_resumeAnimation","onRemove","lastIndex","distances","totalDistance","distance","i","distanceTo","ratioDuration","Util","requestAnimFrame","timestamp","_animate","cancelAnimFrame","slice","_updateLine","lineIndex","lineDuration","stationDuration","undefined","setLatLng","noRequestAnim","p","movingMarker"],"mappings":"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","sourcesContent":["L.interpolatePosition = function (p1, p2, duration, t) {\n    var k = t / duration;\n    k = (k > 0) ? k : 0;\n    k = (k > 1) ? 1 : k;\n    return L.latLng(p1.lat + k * (p2.lat - p1.lat),\n        p1.lng + k * (p2.lng - p1.lng));\n};\n\nL.Marker.MovingMarker = L.Marker.extend({\n\n    //state constants\n    statics: {\n        notStartedState: 0,\n        endedState: 1,\n        pausedState: 2,\n        runState: 3\n    },\n\n    options: {\n        autostart: false,\n        loop: false,\n    },\n\n    initialize: function (latlngs, durations, options) {\n        L.Marker.prototype.initialize.call(this, latlngs[0], options);\n\n        this._latlngs = latlngs.map(function (e, index) {\n            return L.latLng(e);\n        });\n\n        if (durations instanceof Array) {\n            this._durations = durations;\n        } else {\n            this._durations = this._createDurations(this._latlngs, durations);\n        }\n\n        this._currentDuration = 0;\n        this._currentIndex = 0;\n\n        this._state = L.Marker.MovingMarker.notStartedState;\n        this._startTime = 0;\n        this._startTimeStamp = 0;  // timestamp given by requestAnimFrame\n        this._pauseStartTime = 0;\n        this._animId = 0;\n        this._animRequested = false;\n        this._currentLine = [];\n        this._stations = {};\n    },\n\n    isRunning: function () {\n        return this._state === L.Marker.MovingMarker.runState;\n    },\n\n    isEnded: function () {\n        return this._state === L.Marker.MovingMarker.endedState;\n    },\n\n    isStarted: function () {\n        return this._state !== L.Marker.MovingMarker.notStartedState;\n    },\n\n    isPaused: function () {\n        return this._state === L.Marker.MovingMarker.pausedState;\n    },\n\n    start: function () {\n        if (this.isRunning()) {\n            return;\n        }\n\n        if (this.isPaused()) {\n            this.resume();\n        } else {\n            this._loadLine(0);\n            this._startAnimation();\n            this.fire('start');\n        }\n    },\n\n    resume: function () {\n        if (!this.isPaused()) {\n            return;\n        }\n        // update the current line\n        this._currentLine[0] = this.getLatLng();\n        this._currentDuration -= (this._pauseStartTime - this._startTime);\n        this._startAnimation();\n    },\n\n    pause: function () {\n        if (!this.isRunning()) {\n            return;\n        }\n\n        this._pauseStartTime = Date.now();\n        this._state = L.Marker.MovingMarker.pausedState;\n        this._stopAnimation();\n        this._updatePosition();\n    },\n\n    stop: function (elapsedTime) {\n        if (this.isEnded()) {\n            return;\n        }\n\n        this._stopAnimation();\n\n        if (typeof (elapsedTime) === 'undefined') {\n            // user call\n            elapsedTime = 0;\n            this._updatePosition();\n        }\n\n        this._state = L.Marker.MovingMarker.endedState;\n        this.fire('end', {elapsedTime: elapsedTime});\n    },\n\n    addLatLng: function (latlng, duration) {\n        this._latlngs.push(L.latLng(latlng));\n        this._durations.push(duration);\n    },\n\n    moveTo: function (latlng, duration) {\n        this._stopAnimation();\n        this._latlngs = [this.getLatLng(), L.latLng(latlng)];\n        this._durations = [duration];\n        this._state = L.Marker.MovingMarker.notStartedState;\n        this.start();\n        this.options.loop = false;\n    },\n\n    addStation: function (pointIndex, duration) {\n        if (pointIndex > this._latlngs.length - 2 || pointIndex < 1) {\n            return;\n        }\n        this._stations[pointIndex] = duration;\n    },\n\n    onAdd: function (map) {\n        L.Marker.prototype.onAdd.call(this, map);\n\n        if (this.options.autostart && (!this.isStarted())) {\n            this.start();\n            return;\n        }\n\n        if (this.isRunning()) {\n            this._resumeAnimation();\n        }\n    },\n\n    onRemove: function (map) {\n        L.Marker.prototype.onRemove.call(this, map);\n        this._stopAnimation();\n    },\n\n    _createDurations: function (latlngs, duration) {\n        var lastIndex = latlngs.length - 1;\n        var distances = [];\n        var totalDistance = 0;\n        var distance = 0;\n\n        // compute array of distances between points\n        for (var i = 0; i < lastIndex; i++) {\n            distance = latlngs[i + 1].distanceTo(latlngs[i]);\n            distances.push(distance);\n            totalDistance += distance;\n        }\n\n        var ratioDuration = duration / totalDistance;\n\n        var durations = [];\n        for (i = 0; i < distances.length; i++) {\n            durations.push(distances[i] * ratioDuration);\n        }\n\n        return durations;\n    },\n\n    _startAnimation: function () {\n        this._state = L.Marker.MovingMarker.runState;\n        this._animId = L.Util.requestAnimFrame(function (timestamp) {\n            this._startTime = Date.now();\n            this._startTimeStamp = timestamp;\n            this._animate(timestamp);\n        }, this, true);\n        this._animRequested = true;\n    },\n\n    _resumeAnimation: function () {\n        if (!this._animRequested) {\n            this._animRequested = true;\n            this._animId = L.Util.requestAnimFrame(function (timestamp) {\n                this._animate(timestamp);\n            }, this, true);\n        }\n    },\n\n    _stopAnimation: function () {\n        if (this._animRequested) {\n            L.Util.cancelAnimFrame(this._animId);\n            this._animRequested = false;\n        }\n    },\n\n    _updatePosition: function () {\n        var elapsedTime = Date.now() - this._startTime;\n        this._animate(this._startTimeStamp + elapsedTime, true);\n    },\n\n    _loadLine: function (index) {\n        this._currentIndex = index;\n        this._currentDuration = this._durations[index];\n        this._currentLine = this._latlngs.slice(index, index + 2);\n    },\n\n    /**\n     * Load the line where the marker is\n     * @param  {Number} timestamp\n     * @return {Number} elapsed time on the current line or null if\n     * we reached the end or marker is at a station\n     */\n    _updateLine: function (timestamp) {\n        // time elapsed since the last latlng\n        var elapsedTime = timestamp - this._startTimeStamp;\n\n        // not enough time to update the line\n        if (elapsedTime <= this._currentDuration) {\n            return elapsedTime;\n        }\n\n        var lineIndex = this._currentIndex;\n        var lineDuration = this._currentDuration;\n        var stationDuration;\n\n        while (elapsedTime > lineDuration) {\n            // substract time of the current line\n            elapsedTime -= lineDuration;\n            stationDuration = this._stations[lineIndex + 1];\n\n            // test if there is a station at the end of the line\n            if (stationDuration !== undefined) {\n                if (elapsedTime < stationDuration) {\n                    this.setLatLng(this._latlngs[lineIndex + 1]);\n                    return null;\n                }\n                elapsedTime -= stationDuration;\n            }\n\n            lineIndex++;\n\n            // test if we have reached the end of the polyline\n            if (lineIndex >= this._latlngs.length - 1) {\n\n                if (this.options.loop) {\n                    lineIndex = 0;\n                    this.fire('loop', {elapsedTime: elapsedTime});\n                } else {\n                    // place the marker at the end, else it would be at\n                    // the last position\n                    this.setLatLng(this._latlngs[this._latlngs.length - 1]);\n                    this.stop(elapsedTime);\n                    return null;\n                }\n            }\n            lineDuration = this._durations[lineIndex];\n        }\n\n        this._loadLine(lineIndex);\n        this._startTimeStamp = timestamp - elapsedTime;\n        this._startTime = Date.now() - elapsedTime;\n        return elapsedTime;\n    },\n\n    _animate: function (timestamp, noRequestAnim) {\n        this._animRequested = false;\n\n        // find the next line and compute the new elapsedTime\n        var elapsedTime = this._updateLine(timestamp);\n\n        if (this.isEnded()) {\n            // no need to animate\n            return;\n        }\n\n        if (elapsedTime != null) {\n            // compute the position\n            var p = L.interpolatePosition(this._currentLine[0],\n                this._currentLine[1],\n                this._currentDuration,\n                elapsedTime);\n            this.setLatLng(p);\n        }\n\n        if (!noRequestAnim) {\n            this._animId = L.Util.requestAnimFrame(this._animate, this, false);\n            this._animRequested = true;\n        }\n    }\n});\n\nL.Marker.movingMarker = function (latlngs, duration, options) {\n    return new L.Marker.MovingMarker(latlngs, duration, options);\n};\n"]}]}