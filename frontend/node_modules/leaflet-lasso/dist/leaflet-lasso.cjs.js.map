{"version":3,"file":"leaflet-lasso.cjs.js","sources":["../src/lasso-polygon.ts","../src/calc.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/lasso-handler.ts","../src/lasso-control.ts","../src/index.ts"],"sourcesContent":["import * as L from 'leaflet';\nimport * as GeoJSON from 'geojson';\n\nexport class LassoPolygon extends L.Layer {\n    readonly polyline: L.Polyline;\n    readonly polygon: L.Polygon;\n\n    constructor(latlngs: L.LatLngExpression[], options?: L.PolylineOptions) {\n        super();\n\n        this.polyline = L.polyline(latlngs, options);\n        this.polygon = L.polygon(latlngs, { ...options, weight: 0 });\n    }\n\n    onAdd(map: L.Map): this {\n        this.polyline.addTo(map);\n        this.polygon.addTo(map);\n\n        return this;\n    }\n\n    onRemove(): this {\n        this.polyline.remove();\n        this.polygon.remove();\n\n        return this;\n    }\n\n    addLatLng(latlng: L.LatLngExpression): this {\n        this.polyline.addLatLng(latlng);\n        this.polygon.addLatLng(latlng);\n\n        return this;\n    }\n\n    getLatLngs(): L.LatLng[] {\n        return this.polygon.getLatLngs()[0] as L.LatLng[];\n    }\n\n    toGeoJSON(): GeoJSON.Feature<GeoJSON.Polygon> {\n        return this.polygon.toGeoJSON() as GeoJSON.Feature<GeoJSON.Polygon>;\n    }\n}","import * as L from 'leaflet';\nimport * as GeoJSON from 'geojson';\nimport { calculateBounds, toCircle, contains, intersects } from '@terraformer/spatial';\n\nfunction geoJSONGeometryToBounds(geometry: GeoJSON.GeometryObject) {\n    const bounds = calculateBounds(geometry);\n    const leafletBounds = L.latLngBounds([bounds[1], bounds[0]], [bounds[3], bounds[2]]);\n    return leafletBounds;\n}\n\nfunction getCircleMarkerRadius(circleMarker: L.CircleMarker, crs: L.CRS, zoom: number) {\n    const latLng = circleMarker.getLatLng();\n    const point = crs.latLngToPoint(latLng, zoom);\n    const delta = circleMarker.getRadius() / Math.SQRT2;\n    const topLeftPoint = L.point([point.x - delta, point.y - delta]);\n    const topLeftLatLng = crs.pointToLatLng(topLeftPoint, zoom);\n    const radius = crs.distance(latLng, topLeftLatLng);\n    return radius;\n}\n\nfunction circleToGeoJSONGeometry(latLng: L.LatLng, radius: number) {\n    return toCircle(L.GeoJSON.latLngToCoords(latLng), radius).geometry;\n}\n\nfunction layerToGeoJSONGeometry(layer: L.Layer, options: { zoom?: number, crs?: L.CRS } = {}) {\n    if (layer instanceof L.Circle) {\n        const latLng = layer.getLatLng();\n        const radius = layer.getRadius();\n        return circleToGeoJSONGeometry(latLng, radius);\n    } else if (layer instanceof L.CircleMarker) {\n        if (options.zoom != undefined && options.crs != undefined) {\n            const latLng = layer.getLatLng();\n            const radius = getCircleMarkerRadius(layer, options.crs, options.zoom);\n            return circleToGeoJSONGeometry(latLng, radius);\n        } else {\n            console.warn(\"Zoom and CRS is required for calculating CircleMarker polygon, falling back to center point only\");\n            return layer.toGeoJSON().geometry;\n        }\n    } else if (layer instanceof L.Marker || layer instanceof L.Polyline) {\n        return layer.toGeoJSON().geometry;\n    }\n}\n\nfunction polygonContains(polygon: GeoJSON.Polygon, layerGeometry: GeoJSON.GeometryObject) {\n    return contains(polygon, layerGeometry);\n}\n\nfunction polygonIntersects(polygon: GeoJSON.Polygon, layerGeometry: GeoJSON.GeometryObject) {\n    return layerGeometry.type === \"Point\" ?\n        contains(polygon, layerGeometry) :\n        intersects(polygon, layerGeometry);\n}\n\nexport function getLayersInPolygon(polygon: L.Polygon, layers: L.Layer[], options: { zoom?: number, crs?: L.CRS, intersect?: boolean } = {}) {\n    const polygonGeometry = polygon.toGeoJSON().geometry as GeoJSON.Polygon;\n    const polygonBounds = polygon.getBounds();\n\n    const selectedLayers = layers.filter(layer => {\n        // check bounds first (fast)\n        let layerGeometry;\n        let layerBounds;\n        if (layer instanceof L.Polyline) {\n            layerBounds = layer.getBounds();\n        } else {\n            layerGeometry = layerToGeoJSONGeometry(layer, options);\n            layerBounds = geoJSONGeometryToBounds(layerGeometry);\n        }\n\n        const boundsResult = options.intersect ?\n            polygonBounds.intersects(layerBounds) :\n            polygonBounds.contains(layerBounds);\n        if (!boundsResult) {\n            return false;\n        }\n\n        // check full geometry (slow)\n        if (!layerGeometry) {\n            layerGeometry = layerToGeoJSONGeometry(layer, options);\n        }\n\n        const geometryResult = options.intersect ?\n            polygonIntersects(polygonGeometry, layerGeometry) :\n            polygonContains(polygonGeometry, layerGeometry);\n        return geometryResult;\n    });\n    \n    return selectedLayers;\n}","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import * as L from 'leaflet';\nimport { LassoPolygon } from './lasso-polygon';\nimport { getLayersInPolygon } from './calc';\nimport './lasso-handler.css';\n\nexport interface LassoHandlerOptions {\n    polygon?: L.PolylineOptions,\n    intersect?: boolean;\n}\n\ninterface LassoHandlerFinishedEventData {\n    latLngs: L.LatLng[];\n    layers: L.Layer[];\n}\n\nexport type LassoHandlerFinishedEvent = L.LeafletEvent & LassoHandlerFinishedEventData;\n\nexport const ENABLED_EVENT = 'lasso.enabled';\nexport const DISABLED_EVENT = 'lasso.disabled';\nexport const FINISHED_EVENT = 'lasso.finished';\n\nexport const ACTIVE_CLASS = 'leaflet-lasso-active';\n\nexport class LassoHandler extends L.Handler {\n    options: LassoHandlerOptions = {\n        polygon: {\n            color: '#00C3FF',\n            weight: 2,\n        },\n        intersect: false,\n    };\n\n    private map: L.Map;\n\n    private polygon?: LassoPolygon;\n\n    private onMapMouseDownBound = this.onMapMouseDown.bind(this);\n    private onDocumentMouseMoveBound = this.onDocumentMouseMove.bind(this);\n    private onDocumentMouseUpBound = this.onDocumentMouseUp.bind(this);\n\n    constructor(map: L.Map, options: LassoHandlerOptions = {}) {\n        super(map);\n        \n        this.map = map;\n        L.Util.setOptions(this, options);\n    }\n\n    setOptions(options: LassoHandlerOptions) {\n        this.options = { ...this.options, ...options };\n    }\n\n    toggle() {\n        if (this.enabled()) {\n            this.disable();\n        } else {\n            this.enable();\n        }\n    }\n    \n    addHooks() {\n        this.map.getPane('mapPane');\n        this.map.getContainer().addEventListener('mousedown', this.onMapMouseDownBound);\n        this.map.getContainer().addEventListener('touchstart', this.onMapMouseDownBound);\n        \n        const mapContainer = this.map.getContainer();\n        mapContainer.classList.add(ACTIVE_CLASS);\n\n        this.map.dragging.disable();\n        this.map.fire(ENABLED_EVENT);\n    }\n\n    removeHooks() {\n        if (this.polygon) {\n            this.map.removeLayer(this.polygon);\n            this.polygon = undefined;\n        }\n\n        this.map.getContainer().removeEventListener('mousedown', this.onMapMouseDownBound);\n        this.map.getContainer().removeEventListener('touchstart', this.onMapMouseDownBound);\n        document.removeEventListener('mousemove', this.onDocumentMouseMoveBound);\n        document.removeEventListener('touchmove', this.onDocumentMouseMoveBound);\n        document.removeEventListener('mouseup', this.onDocumentMouseUpBound);\n        document.removeEventListener('touchend', this.onDocumentMouseUpBound);\n\n        this.map.getContainer().classList.remove(ACTIVE_CLASS);\n        document.body.classList.remove(ACTIVE_CLASS);\n\n        this.map.dragging.enable();\n        this.map.fire(DISABLED_EVENT);\n    }\n\n    private onMapMouseDown(event: Event) {\n        let event2 = this.eventToMouseEvent('down', event);\n        if (!event2) {\n            return;\n        }\n\n        // activate lasso only for left mouse button click\n        if (event instanceof MouseEvent && !(event as any)._simulated && event.buttons !== 1) {\n            this.disable();\n            return;\n        }\n\n        // skip clicks on controls\n        if ((event.target as HTMLElement).closest('.leaflet-control-container')) {\n            return;\n        }\n\n        const latLng = this.map.mouseEventToLatLng(event2);\n        this.polygon = new LassoPolygon([latLng], this.options.polygon).addTo(this.map);\n\n        document.body.classList.add(ACTIVE_CLASS);\n\n        document.addEventListener('mousemove', this.onDocumentMouseMoveBound);\n        document.addEventListener('touchmove', this.onDocumentMouseMoveBound);\n        document.addEventListener('mouseup', this.onDocumentMouseUpBound);\n        document.addEventListener('touchend', this.onDocumentMouseUpBound);\n\n        event.preventDefault();\n    }\n\n    private onDocumentMouseMove(event: Event) {\n        let event2 = this.eventToMouseEvent('move', event);\n        if (!event2) {\n            return;\n        }\n\n        if (!this.polygon) {\n            return;\n        }\n\n        // keep lasso active only if left mouse button is hold\n        if (event instanceof MouseEvent && !(event as any)._simulated && event.buttons !== 1) {\n            console.warn('mouseup event was missed');\n            this.finish();\n            return;\n        }\n\n        const latLng = this.map.mouseEventToLatLng(event2);\n        this.polygon.addLatLng(latLng);\n\n        event.preventDefault();\n    }\n\n    private onDocumentMouseUp(event: Event) {\n        this.finish();\n\n        event.preventDefault();\n    }\n\n    private eventToMouseEvent(type: string, event: Event) {\n        if (event instanceof MouseEvent) {\n            return event;\n        }\n        if (event instanceof TouchEvent && event.touches.length === 1) {\n            return new MouseEvent(type, {\n                screenX: event.touches[0].screenX,\n                screenY: event.touches[0].screenY,\n                clientX: event.touches[0].clientX,\n                clientY: event.touches[0].clientY,\n                buttons: 1,\n            });\n        }\n    }\n\n    private finish() {\n        if (!this.polygon) {\n            return;\n        }\n\n        const layers: L.Layer[] = [];\n        this.map.eachLayer(layer => {\n            if (layer === this.polygon || layer === this.polygon!.polyline || layer === this.polygon!.polygon) {\n                return;\n            }\n\n            if (L.MarkerCluster && layer instanceof L.MarkerCluster) {\n                layers.push(...layer.getAllChildMarkers());\n            } else if (layer instanceof L.Marker || layer instanceof L.Path) {\n                layers.push(layer);\n            }\n        });\n\n        const selectedFeatures = getLayersInPolygon(this.polygon.polygon, layers, {\n            zoom: this.map.getZoom(),\n            crs: this.map.options.crs,\n            intersect: this.options.intersect,\n        });\n\n        this.map.fire(FINISHED_EVENT, {\n            latLngs: this.polygon.getLatLngs(),\n            layers: selectedFeatures,\n        } as LassoHandlerFinishedEventData);\n\n        this.disable();\n    }\n}\n","import * as L from 'leaflet';\nimport { LassoHandler, LassoHandlerOptions } from './lasso-handler';\nimport './lasso-control.css';\n\nexport type LassoControlOptions = LassoHandlerOptions & L.ControlOptions;\n\nexport class LassoControl extends L.Control {\n    options: LassoControlOptions = {\n        position: 'topright',\n    };\n\n    private lasso?: LassoHandler;\n\n    constructor(options: LassoControlOptions = {}) {\n        super();\n\n        L.Util.setOptions(this, options);\n    }\n\n    setOptions(options: LassoControlOptions) {\n        this.options = { ...this.options, ...options };\n        \n        if (this.lasso) {\n            this.lasso.setOptions(this.options);\n        }\n    }\n\n    onAdd(map: L.Map) {\n        this.lasso = new LassoHandler(map, this.options);\n\n        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control') as HTMLDivElement;\n        const button = L.DomUtil.create('a', 'leaflet-control-lasso', container) as HTMLAnchorElement;\n        button.href = 'javascript:void(0)';\n        button.title = 'Toggle Lasso';\n        button.setAttribute('role', 'button');\n        button.setAttribute('aria-label', button.title);\n\n        L.DomEvent.addListener(button, 'click', this.toggle, this);\n        L.DomEvent.disableClickPropagation(button);\n\n        return container;\n    }\n\n    enabled() {\n        if (!this.lasso) {\n            return false;\n        }\n        return this.lasso.enabled();\n    }\n\n    enable() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.enable();\n    }\n\n    disable() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.disable();\n    }\n\n    toggle() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.toggle();\n    }\n}\n","import 'leaflet';\nimport { LassoHandler } from './lasso-handler';\nimport { LassoControl } from './lasso-control';\n\ndeclare module 'leaflet' {\n    type Lasso = LassoHandler;\n    let Lasso: typeof LassoHandler;\n\n    let lasso: (...args: ConstructorParameters<typeof LassoHandler>) => LassoHandler;\n    \n    namespace Control {\n        type Lasso = LassoControl;\n        let Lasso: typeof LassoControl;\n    }\n\n    namespace control {\n        let lasso: (...args: ConstructorParameters<typeof LassoControl>) => LassoControl;\n    }\n}\n\nif (typeof window.L !== 'undefined') {\n    window.L.Lasso = LassoHandler;\n    window.L.lasso = (...args: ConstructorParameters<typeof LassoHandler>) => new LassoHandler(...args);\n\n    window.L.Control.Lasso = LassoControl;\n    window.L.control.lasso = (...args: ConstructorParameters<typeof LassoControl>) => new LassoControl(...args);\n}\n\nexport * from './lasso-handler';\nexport * from './lasso-control';"],"names":["L.polyline","L.polygon","L.Layer","calculateBounds","L.latLngBounds","L.point","toCircle","L.GeoJSON","L.Circle","L.CircleMarker","L.Marker","L.Polyline","contains","intersects","L.Util","L.MarkerCluster","L.Path","L.Handler","L.DomUtil","L.DomEvent","L.Control"],"mappings":"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"}