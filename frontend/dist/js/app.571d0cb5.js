(function(t){function e(e){for(var a,o,s=e[0],l=e[1],c=e[2],h=0,u=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&u.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(u.length)u.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],a=!0,s=1;s<i.length;s++){var l=i[s];0!==r[l]&&(a=!1)}a&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},r={app:0},n=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";i("85ec")},1:function(t,e){},"15c6":function(t,e,i){"use strict";i("f827")},"1c70":function(t,e,i){},"21c6":function(t,e,i){"use strict";var a=i("fdb8"),r=i("9c4a"),n=(i("57ad"),i("2877")),o=Object(n["a"])(r["default"],a["a"],a["b"],!1,null,"3f80c7c0",null);e["default"]=o.exports},"2beb":function(t,e,i){"use strict";i("c876")},3756:function(t,e,i){},5409:function(t,e,i){"use strict";i("1c70")},"56d7":function(t,e,i){"use strict";i.r(e);var a=i("2b0e"),r=i("5c96"),n=i.n(r),o=(i("0fae"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"1400px"},attrs:{id:"app"}},[i("div",{staticClass:"container-fluid",staticStyle:{"padding-left":"0px","padding-right":"0px"}},[i("div",{staticClass:"row",staticStyle:{"margin-left":"0px","margin-right":"0px"}},[i("div",{staticClass:"col-5 content",staticStyle:{"padding-left":"0px","padding-right":"0px"}},[i("div",{staticClass:"row",staticStyle:{"margin-left":"0px","margin-right":"0px"}},[i("div",{staticClass:"col-6 content",staticStyle:{"padding-left":"0px","padding-right":"0px"}},[i("VideoView",{attrs:{videoList:t.videoList,videoId:t.videoId,videoData:t.videoData,w:t.width,h:t.height},on:{conveyData:t.updateData,changemap:t.changemap}})],1),i("div",{staticClass:"col-6 content",staticStyle:{"padding-left":"0px","padding-right":"0px"}},[i("TextView",{attrs:{region:t.region,date:t.date,number:t.number,coords:t.coords},on:{passTime:t.updateTime,change:t.change}})],1)]),i("AudioView",{attrs:{content:t.content,region:t.region,regionsFlow:t.regionsFlow,videoId:t.videoId,videoData:t.videoData,nodes:t.nodes}})],1),i("div",{staticClass:"col-7 content",staticStyle:{"padding-left":"0px","padding-right":"0px"}},[i("FaceView",{attrs:{date:t.date,startTime:t.startTime,timeLength:t.timeLength,videoId:t.videoId,videoData:t.videoData,dir:t.dir,type:t.type},on:{conveyRegion:t.updateRegion,conveyHighOrder:t.updateHighOrder,conveyNumber:t.updateNumber,conveyRegionFlow:t.updateRegionFlow,changeData:t.initdraw}})],1)])])])}),s=[],l=i("bc3a"),c=i.n(l),d=i("28dd");const h="get",u="post",g="http://127.0.0.1:8888";function p(t,e,i,a){let r;i===h?r=c.a.get:i===u&&(r=c.a.post),r(t,e).then(t=>{200===t.status?a(t):console.error(t)}).catch(t=>{console.error(t)})}function f(t,e){const i=`${g}/initialization/${t}`,a={};p(i,a,h,e)}function y(t,e){const i=`${g}/pose/${t}`,a={};p(i,a,h,e)}function m(t,e){const i=`${g}/videoInfo/${t}`,a={};p(i,a,h,e)}function v(t,e){const i=`${g}/vision/${t}`,a={};p(i,a,h,e)}function C(t){const e=g+"/getAllUsers",i={};p(e,i,h,t)}function w(t,e){const i=`${g}/getDatesByUser/${t}`,a={};p(i,a,h,e)}function b(t,e,i){const a=`${g}/display/${t}/${e}`,r={};p(a,r,h,i)}function x(t,e,i,a,r){const n=`${g}/getHighOrder/${t}/${e}/${i}/${a}`,o={};p(n,o,h,r)}function k(t,e){const i=`${g}/getVanAreasMap/${t}`,a={};p(i,a,h,e)}function F(t){const e=g+"/getMap",i={};p(e,i,h,t)}function L(t,e){const i=`${g}/getRegionFlow/${t}`,a={};p(i,a,h,e)}function S(t,e){const i=`${g}/getOverview/${t}`,a={};p(i,a,h,e)}function T(t,e,i){const a=`${g}/getRegionInOut/${t}/${e}`,r={};p(a,r,h,i)}function O(t,e,i,a){const r=`${g}/audio/${t}/${e}/${i}`,n={};p(r,n,h,a)}function A(t,e){const i=`${g}/text/${t}`,a={};p(i,a,h,e)}function R(t,e){const i=g+"/fetchroaddata1";p(i,t,u,e),console.log(e)}function P(t,e){const i=g+"/fetchroaddata2";p(i,t,u,e),console.log(e)}function D(t,e){const i=g+"/fetchroaddata3";p(i,t,u,e),console.log(e)}function I(t){const e=g+"/static/final_back.json";p(e,{},h,t)}a["default"].use(d["a"]);var V={dataServerUrl:g,initialization:f,videoInfo:m,poseData:y,visionData:v,audioData:O,textData:A,fetchRoadDataPost1:R,fetchRoadDataPost2:P,fetchRoadDataPost3:D,fetchnode:I,getAllUsers:C,getDatesByUser:w,display:b,getHighOrder:x,getVanAreasMap:k,getOverview:S,getRegionFlow:L,getRegionInOut:T,getMap:F},E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"videoview"}},[i("div",{staticClass:"card"},[t._m(0),i("div",{staticClass:"card-block",attrs:{id:"videoPlayerContainer"}},[i("div",{staticClass:"labelsContainer"},[i("div",[i("span",{staticClass:"toolName"},[t._v("Day Types")]),i("el-select",{attrs:{filterable:"",placeholder:"Please select",size:"mini"},model:{value:t.valueOfDate,callback:function(e){t.valueOfDate=e},expression:"valueOfDate"}},t._l(t.dates,(function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),i("span",{staticClass:"toolName"},[t._v("Periods")]),i("div",{staticStyle:{"margin-left":"10%","margin-right":"10%"}},[i("div",{staticStyle:{height:"10px"}}),i("el-slider",{attrs:{range:"",step:1,max:6,"show-tooltip":!1,marks:t.marks},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),i("div",{staticStyle:{height:"20px"}}),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.display}},[t._v("Display")]),i("div",{staticStyle:{height:"10px"}}),i("div",{attrs:{id:"my_dataviz"}})],1)])])])},M=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"card-header"},[i("div",{staticStyle:{float:"left","margin-left":"0px","margin-top":"0px"}},[i("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Overview")])])])}],N=(i("0cfb"),{data(){return{value:[0,6],marks:{0:"0",1:"5",2:"10",3:"15",5:"60"},users:[],dates:["Weekdays","Holidays"],valueOfUser:"",valueOfDate:"",overview:[]}},watch:{valueOfDate(t){V.getOverview(this.valueOfDate,t=>{this.overview=t.data,console.log(this.overview),this.drawChord(this.overview[0],this.overview[1],this.overview[2],this.overview[3])})}},methods:{display:function(t){this.$emit("conveyData",this.valueOfDate)},drawChord:function(t,e,i,a){d3.selectAll(".chord").remove();let r=d3.select("#my_dataviz").append("svg").attr("class","chord").attr("width",280).attr("height",300).append("g").attr("transform","translate(140,130)"),n=30;for(let c=0;c<i.length;c++)i[c]=i[c]*n/a;let o=["#99CCCC","#FFCC99","#FFCCCC","#0099cc","#CC9999","#FF6666","#FFFF99","#CCCCFF","#CC9966","#CCCCCC","#666666","#99CC66","#CCCC99"],s=d3.chord().padAngle(.05).sortSubgroups(d3.descending)(t);console.log("-----------------------"),console.log(s.groups);let l=[];for(let c=0;c<s.groups.length;c++){let t=s.groups[c],i=t.startAngle,a=t.endAngle,r=a-i;for(let n=0;n<e.length;c++)if(0!==e){let t={};a=i+r*e[n],t["regionId"]=n,t["startAngle"]=i,t["endAngle"]=a,l.push(t),i=a}}r.datum(s).append("g").selectAll("g").data((function(t){return t.groups})).enter().append("g").append("path").style("fill","grey").style("stroke","black").style("stroke-width",.1).attr("d",d3.arc().innerRadius(75).outerRadius(80)),r.datum(s).append("g").selectAll("g").data((function(t){return t.groups})).enter().append("g").append("path").style("fill","grey").style("stroke","black").style("stroke-width",.1).attr("d",d3.arc().innerRadius((function(t,e){return 90+i[e]})).outerRadius((function(t,e){return 95+i[e]}))),r.datum(s).append("g").selectAll("path").data((function(t){return t})).enter().append("path").attr("d",d3.ribbon().radius(75)).style("fill",(function(t){return o[t.source.index]})).style("stroke",(function(t){return o[t.source.index]})).style("stroke-width",.1)}},mounted:function(){let t=[[0,396,101,299,133,411,39,51,29,15,10,16,31],[300,0,572,843,224,476,33,53,14,7,7,5,2],[94,379,0,367,104,187,12,29,8,5,5,8,4],[246,789,585,0,351,1364,101,114,52,19,28,23,17],[120,184,98,438,0,1432,218,255,61,54,54,11,7],[398,485,247,1606,1329,0,205,194,83,91,47,56,19],[46,41,23,98,212,245,0,51,81,14,13,20,4],[27,46,41,111,267,238,64,0,20,77,5,2,1],[19,11,9,38,73,116,74,28,0,113,113,27,11],[14,11,3,57,68,57,9,80,96,0,18,2,0],[12,12,9,16,84,27,10,6,67,17,0,20,12],[12,6,6,22,7,35,17,3,81,1,25,0,29],[18,2,2,13,23,53,2,1,1,1,11,41,0]],e=[];for(let a=0;a<t.length;a++)e[a]=a+10;let i=[1];this.drawChord(t,i,e,t.length+10)}}),z=N,j=(i("c4b3"),i("2877")),q=Object(j["a"])(z,E,M,!1,null,"4bddc128",null),G=q.exports,H=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"textview"}},[i("div",{staticClass:"card"},[t._m(0),i("div",{staticClass:"card-block",attrs:{id:"textContainer"}},[i("svg",{attrs:{id:"timeView"}})])])])},B=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"card-header"},[i("div",{staticStyle:{float:"left","margin-left":"0px","margin-top":"0px"}},[i("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Temporal View")])])])}],U={name:"TextView",components:{},props:["region","date","number"],data(){return{width:280,height:400,exist:0,content:[],data:[],startTime:0,timeLength:0,svg:null}},computed:{information(){const{date:t,region:e}=this;return{date:t,region:e}}},watch:{information(t){V.getRegionInOut(this.date,this.region,t=>{-1!==this.region&&(1===this.number?(this.updateSvg(),this.drawTimeSlot(t.data[0],t.data[1],this.width,this.height,0,0,0),this.drawLegend()):2===this.number?(0===this.exist|2===this.exist&&(this.updateSvg(),this.exist=0),this.drawTimeSlot(t.data[0],t.data[1],this.width/2,this.height,this.exist*this.width/2,0,this.exist),this.exist++):3===this.number?(0===this.exist|3===this.exist&&(this.updateSvg(),this.exist=0),this.drawTimeSlot(t.data[0],t.data[1],this.width/2,this.height/2,this.exist%2*this.width/2,Math.floor(this.exist/2)*this.height/2,this.exist),this.exist++):4===this.number&&(0===this.exist|4===this.exist&&(this.updateSvg(),this.exist=0),this.drawTimeSlot(t.data[0],t.data[1],this.width/2,this.height/2,this.exist%2*this.width/2,Math.floor(this.exist/2)*this.height/2,this.exist),this.exist++))})}},mounted:function(){const t=280,e=400,i=d3.select("#timeView").attr("width",t).attr("height",e);this.svg=i,this.drawLegend()},methods:{updateSvg:function(){d3.select("#timeView").remove();const t=d3.select("#textContainer").append("svg").attr("id","timeView").attr("width",this.width).attr("height",this.height);this.svg=t},drawLegend:function(){let t=this.svg,e=["Food","Shop & Service","Outdoors & Recreation","Professional Places","Travel & Transport","Nightlife Spot","Arts & Entertainment","College & University","Residence","Event","Else"],i=d3.scaleOrdinal(["#99CCCC","#FFCC99","#FFCCCC","#0099CC","#CC9999","#FF6666","#e3e309","#CCCCFF","#CC9966","#CCCCCC","#bab0ab"]).domain(e);t.selectAll("mydots").data(e).enter().append("circle").attr("cx",185).attr("cy",(function(t,e){return 10+10*e})).attr("r",2).style("fill",(function(t){return i(t)})),t.selectAll("mylabels").data(e).enter().append("text").attr("x",195).attr("y",(function(t,e){return 10+10*e})).style("fill",(function(t){return i(t)})).text((function(t){return t})).attr("text-anchor","left").style("alignment-baseline","middle").style("font-size",8)},drawTimeSlot:function(t,e,i,a,r,n,o){let s=this.svg;const l=1===this.number?20:10,c=10,d=a-2*l-c,h=i/2-(1===this.number?40:10),u=24,g=(d-2*c)/u,p=2*h+(1===this.number?40:10),f=4;let y;y=this.findMax(e),y=this.findMax(t);let m=h/y,v=this.computePosition(t,e,m,i/2);s.append("g").classed("rects",!0).selectAll("rect").data(v).enter().append("rect").classed("rect",!0).attr("x",t=>r+t[1]).attr("y",t=>n+l+c+t[0]*g).attr("width",t=>t[2]).attr("height",g).attr("fill",t=>t[3]).attr("opacity",1),s.append("line").style("Stroke","black").style("opacity",.5).attr("x1",r+i/2).attr("y1",n+l).attr("x2",r+i/2).attr("y2",n+l+d);this.startTime=(u-f)/2,this.timeLength=f,this.$emit("passTime",this.startTime,this.timeLength);let C=s.selectAll(".draggableSquare"+o).data([{x:r+(i-p)/2,y:n+l+c+(u-f)/2*g,width:p,height:4*g}]).enter().append("g").attr("class","draggableSquare"+o);C.append("svg:rect").attr("class","resizingSquare"+o).attr("width",(function(t){return t.width+12})).attr("height",(function(t){return t.height+12})).attr("x",(function(t){return t.x-6})).attr("y",(function(t){return t.y-6})).attr("rx",6).attr("ry",6).attr("opacity",0).style("fill","white").style("cursor","s-resize"),C.append("svg:rect").attr("class","square"+o).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height})).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).style("fill","black").style("cursor","move").attr("opacity",.1),d3.select(".square"+o).call(this.drag(l,c,g,o)),d3.select(".resizingSquare"+o).call(this.resize(l,c,g,o))},resize:function(t,e,i,a){let r,n,o,s,l=this,c=d3.select(".resizingSquare"+a),d=d3.select(".square"+a);function h(){d.attr("opacity",.5)}function u(){r=Number(d3.select(this).attr("x")),n=Number(d3.select(this).attr("y")),o=Number(d3.select(this).attr("width")),s=Number(d3.select(this).attr("height"));let t={x:r+o,y:n+s};c.attr("height",(function(){return s+(d3.event.sourceEvent.offsetY-t.y)+12})),d.attr("height",(function(){return s+(d3.event.sourceEvent.offsetY-t.y)}))}function g(){let a=Math.round(d.attr("height")/i);a=a<0?1:a,c.attr("height",a*i+12),d.attr("height",a*i),l.startTime=Math.round((d.attr("y")-t-e)/i),l.timeLength=d.attr("height")/i,l.$emit("passTime",l.startTime,l.timeLength),d.attr("opacity",.1)}return d3.drag().on("start",h).on("drag",u).on("end",g)},drag:function(t,e,i,a){let r,n,o=this,s=d3.select(".draggableSquare"+a),l=d3.select(".resizingSquare"+a),c=d3.select(".square"+a);function d(){c.attr("opacity",.5),r=d3.event.y-c.attr("y"),n=d3.event.y-l.attr("y")}function h(){s.select(".square"+a).attr("y",d3.event.y-r),s.select(".resizingSquare"+a).attr("y",d3.event.y-n)}function u(){let a=Math.round((c.attr("y")-t-e)/i),r=c.attr("y")-a*i-t-e;c.attr("y",c.attr("y")-r),l.attr("y",l.attr("y")-r),d3.select(this).attr("opacity",.1),o.startTime=a,o.timeLength=c.attr("height")/i,o.$emit("passTime",o.startTime,o.timeLength)}return d3.drag().on("start",d).on("drag",h).on("end",u)},findMax:function(t){let e=0;for(let i=0;i<t.length;i++){let a=t[i],r=0;for(let t=0;t<a.length;t++)r+=a[t];e=r>e?r:e}return e},computePosition:function(t,e,i,a){let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],l=a,c=a,d=["#bab0ab","#99CCCC","#FFCC99","#FFCCCC","#0099CC","#CC9999","#FF6666","#e3e309","#CCCCFF","#CC9966","#CCCCCC"];for(let t=0;t<o.length;t++){let e=[];l-=o[t]*i,e.push(n),e.push(l),e.push(o[t]*i),e.push(d[t]),r.push(e)}for(let t=0;t<s.length;t++){let e=[];e.push(n),e.push(c),c+=s[t]*i,e.push(s[t]*i),e.push(d[t]),r.push(e)}}return r}}},J=U,K=(i("2beb"),Object(j["a"])(J,H,B,!1,null,"65210b1b",null)),W=K.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"audioview"}},[i("div",{staticClass:"card"},[t._m(0),i("div",{staticClass:"card-block",attrs:{id:"audioContainer"}},[i("svg",{attrs:{id:"sankey"}})])])])},Z=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"card-header"},[i("div",{staticStyle:{float:"left","margin-right":"40px"}},[i("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("State Transition View")])])])}],Q=(i("e7a4"),i("1f82"),i("42ef"),{name:"AudioView",components:{},props:["content","region","regionsFlow"],watch:{content(t){this.compute();let e=this.svg;e.selectAll(".highOrder").remove(),this.drawSankey()}},data(){return{region_number:13,column:0,row:0,rects:[],links:[],hLinks:[],nextLinks:[],lastLinks:[],svg:null,total:0,cx:0,cy:0,data:{entropy:[{cx:420,cy:60,r:8,color:"#77787b",opacity:.5},{cx:420,cy:76,r:8,color:"#ffc20e",opacity:1},{cx:420,cy:92,r:8,color:"#77787b",opacity:.5},{cx:420,cy:156,r:8,color:"#77787b",opacity:.5}],nodes:[{id:"A1",x:100,y:50,width:20,height:50,color:"#f4cae4"},{id:"A2",x:200,y:50,width:20,height:50,color:"#f4cae4"},{id:"A4",x:400,y:50,width:20,height:50,color:"#f4cae4"},{id:"B2",x:225,y:90,width:20,height:50,color:"#fdcdac"},{id:"C2",x:200,y:130,width:20,height:50,color:"#FF5151"},{id:"D2",x:225,y:170,width:20,height:50,color:"#b3e2cd"},{id:"E2",x:200,y:210,width:20,height:50,color:"#cbd5e8"},{id:"ABC2",x:200,y:100,width:25,height:30,color:"white"},{id:"BCD2",x:220,y:140,width:25,height:30,color:"white"},{id:"CDE2",x:200,y:180,width:25,height:30,color:"white"},{id:"B",x:325,y:90,width:20,height:50,color:"#fdcdac"},{id:"C4",x:400,y:130,width:20,height:50,color:"#FF5151"},{id:"E1",x:100,y:210,width:20,height:50,color:"#cbd5e8"}],links:[{link:{source:[120,80],target:[200,150]},value:10,color:"#77787b",opacity:1},{link:{source:[120,90],target:[200,190]},value:8,color:"#77787b",opacity:1},{link:{source:[200,190],target:[225,190]},value:8,color:"#77787b",opacity:1},{link:{source:[120,250],target:[200,200]},value:10,color:"#77787b",opacity:1},{link:{source:[200,200],target:[225,200]},value:10,color:"#77787b",opacity:1},{link:{source:[120,230],target:[200,120]},value:8,color:"#77787b",opacity:1},{link:{source:[200,120],target:[225,120]},value:8,color:"#77787b",opacity:1},{link:{source:[120,230],target:[200,120]},value:8,color:"#77787b",opacity:1},{link:{source:[200,120],target:[225,120]},value:8,color:"#77787b",opacity:1},{link:{source:[220,150],target:[245,150]},value:10,color:"#77787b",opacity:1},{link:{source:[245,150],target:[325,110]},value:10,color:"#77787b",opacity:1},{link:{source:[245,190],target:[325,120]},value:8,color:"#77787b",opacity:1},{link:{source:[345,110],target:[400,70]},value:8,color:"#77787b",opacity:1},{link:{source:[345,120],target:[400,150]},value:8,color:"#77787b",opacity:1}]}}},mounted:function(){const t=this.data,e=500,i=320,a=d3.select("#sankey").attr("width",e).attr("height",i);this.svg=a;a.append("g").classed("circles",!0).selectAll("circle").data(t.entropy).enter().append("circle").attr("class","highOrder").attr("cx",t=>t.cx).attr("cy",t=>t.cy).attr("r",t=>t.r).attr("fill",t=>t.color).attr("opacity",t=>t.opacity),a.append("g").classed("nodes",!0).selectAll("rect").data(t.nodes).enter().append("rect").attr("class","highOrder").attr("x",t=>t.x).attr("y",t=>t.y).attr("width",t=>t.width).attr("height",t=>t.height).attr("fill",t=>t.color).attr("opacity",1);let r=d3.linkHorizontal();a.append("g").classed("links",!0).selectAll("path").data(t.links).enter().append("path").attr("class","highOrder").attr("d",t=>r(t.link)).attr("fill","none").attr("stroke",t=>t.color).attr("stroke-width",t=>t.value).attr("opacity",t=>t.opacity)},methods:{drawSankey:function(){let t=this.svg,e=t.attr("width"),i=t.attr("height"),a=50,r=30,n=this.column,o=this.row,s=this.rects,l=20,c=(i-2*r)/o*4/3,d=(e-2*a)/n,h=3*c/4,u=5,g=a+(e-2*a-d*(n-1)-2*l-u)/2,p=c/2-2,f=p-10,y=this.links,m=this.hLinks,v=this.nextLinks,C=this.lastLinks,w=d3.linkHorizontal();t.append("g").classed("links",!0).selectAll("path").data(y).enter().append("path").attr("class","highOrder").attr("d",t=>{let e={source:[0,0],target:[0,0]};return e.source[0]=g+d*t.start[0]+2*l+u,e.source[1]=c/3+r+h*t.start[1]+4*t.outR,e.target[0]=g+d*t.end[0],e.target[1]=c/3+r+h*t.end[1]+4*t.inR,w(e)}).attr("fill","none").attr("stroke","#77787b").attr("stroke-width",4).attr("opacity",1),t.append("g").classed("links",!0).selectAll("path").data(m).enter().append("path").attr("class","highOrder").attr("d",t=>{let e={source:[0,0],target:[0,0]};return 0===t.type?(e.source[0]=g+d*t.point[0]-1,e.source[1]=c/3+r+h*t.point[1]+4*t.index,e.target[0]=g+d*t.point[0]+l+u,e.target[1]=c/3+r+h*t.point[1]+4*t.index):(e.source[0]=g+d*t.point[0]+l,e.source[1]=c/3+r+h*t.point[1]+4*t.index,e.target[0]=g+d*t.point[0]+2*l+u+1,e.target[1]=c/3+r+h*t.point[1]+4*t.index),w(e)}).attr("fill","none").attr("stroke","#77787b").attr("stroke-width",4).attr("opacity",1),t.append("g").classed("links",!0).selectAll("path").data(v).enter().append("path").attr("class","highOrder").attr("d",t=>{let e={source:[0,0],target:[0,0]};return e.source[0]=g+d*t.start[0]+l+(l+u)*(t.start[1]%2),e.source[1]=c/4+i/2-i/8+4*t.outR,e.target[0]=g+d*t.end[0],e.target[1]=c/3+r+h*t.end[1]+4*t.inR,w(e)}).attr("fill","none").attr("stroke","#77787b").attr("stroke-width",4).attr("opacity",1),t.append("g").classed("links",!0).selectAll("path").data(C).enter().append("path").attr("class","highOrder").attr("d",t=>{let e={source:[0,0],target:[0,0]};return e.source[0]=g+d*t.start[0]+2*l+u,e.source[1]=c/3+r+h*t.start[1]+4*t.outR,e.target[0]=g+d*t.end[0]+(l+u)*(t.end[1]%2),e.target[1]=i/10+i/2-i/8+4*t.inR,w(e)}).attr("fill","none").attr("stroke","#77787b").attr("stroke-width",4).attr("opacity",1);for(let b=0;b<s.length;b++){let t=s[b],e=g+d*t.column+t.row%2*(l+u)+l/2,a=r+h*t.row+c/2;t.column===n-2?(this.cx=e,this.drawSingleGlyph(t.regionId,e,i/2,i/8-4,i/8-14)):this.drawSingleGlyph(t.regionId,e,a,f,p)}t.append("circle").attr("class","highOrder").attr("cx",this.cx).attr("cy",i/2).attr("r",i/8-14).attr("fill","white")},drawSingleGlyph(t,e,i,a,r){let n=this.regionsFlow[t],o=this.svg,s=o.append("g").attr("class","highOrder").attr("transform","translate("+e+","+i+")"),l=["#99CCCC","#FFCC99","#FFCCCC","#0099CC","#CC9999","#FF6666","#FFFF99","#CCCCFF","#CC9966","#CCCCCC"],c=d3.pie().value((function(t){return t})),d=c(n);s.selectAll("whatever").data(d).enter().append("path").attr("d",d3.arc().innerRadius(a).outerRadius(r)).attr("fill",(function(t){return l[t.index]})).attr("stroke","black").style("stroke-width","0.3px").style("opacity",1),s.append("circle").attr("class","circle").attr("r",a).attr("fill","white").attr("opacity",0)},compute:function(){let t,e=0,i=[],a={},r=[],n=[],o=[],s=[],l=[],c=[],d=["#99CCCC","#FFCC99","#FFCCCC","#0099cc","#CC9999","#FF6666","#FFFF99","#CCCCFF","#CC9966","#CCCCCC","#666666","#99CC66","#CCCC99"];for(let f in this.content){let t=f.split("_");e=e>t.length?e:t.length;for(let e=0;e<t.length-1;e++)this.isInArray(i,Number(t[e]))||i.push(Number(t[e]));for(let e=0;e<this.content[f].length;e++)0!==this.content[f][e]&&(this.isInArray(i,e)||i.push(e))}t=i.length,this.row=t,this.column=e;for(let f=0;f<t;f++)if(i[f]===this.region){let e=i[Math.floor(t/2)];i[Math.floor(t/2)]=this.region,i[f]=e}for(let f=0;f<t;f++)a[i[f]]=f;for(let f=0;f<e;f++){r[f]=[];for(let e=0;e<t;e++)r[f][e]=[0,0]}for(let f=0;f<t;f++)n[f]=[],o[f]=[];let h=0;for(let f in this.content){let t,i=f.split("_"),c=0;for(let e=0;e<this.content[f].length;e++)c+=this.content[f][e];h+=c,this.total=h;for(let o=0;o<i.length-1;o++){let h={regionId:0,column:0,row:0,color:"black"};h.regionId=Number(i[o]),h.column=e-i.length+o,h.row=a[Number(i[o])],h.color=d[h.row],s.push(h),t=[h.column,h.row];let u={start:[0,0],end:[0,0],outR:0,inR:0,flow:0};o<i.length-2&&(u.start=t,u.end=[h.column+1,a[Number(i[o+1])]],u.flow=c,u.outR=r[h.column][h.row][1],r[h.column][h.row][1]++,u.inR=r[h.column+1][a[Number(i[o+1])]][0],r[h.column+1][a[Number(i[o+1])]][0]++,o===i.length-3?n[t[1]].push(u):l.push(u))}for(let n=0;n<this.content[f].length;n++)if(0!==this.content[f][n]){let i={regionId:0,column:0,row:0,color:"black"};i.regionId=n,i.column=e-1,i.row=a[n],i.color=d[i.row],s.push(i);let l={start:[0,0],end:[0,0],outR:0,inR:0,flow:0};l.start=t,l.end=[t[0]+1,a[n]],l.flow=this.content[f][n],l.outR=r[t[0]][t[1]][1],r[t[0]][t[1]][1]++,l.inR=r[t[0]+1][a[n]][0],r[t[0]+1][a[n]][0]++,o[a[n]].push(l)}}let u=[],g=0;for(let f=0;f<t;f++)for(let t=0;t<o[f].length;t++){let e=o[f][t];e.outR=g,u.push(e),g++}this.nextLinks=u;let p=[];g=0;for(let f=0;f<t;f++)for(let t=0;t<n[f].length;t++){let e=n[f][t];e.inR=g,p.push(e),g++}this.lastLinks=p,console.log(p);for(let f=0;f<e;f++)if(f!==e-2)for(let e=0;e<t;e++){let t=r[f][e],i=t[0],a=t[1];if(e%2===0)for(let r=0;r<a;r++)c.push({type:1,point:[f,e],index:r});else for(let r=0;r<i;r++)c.push({type:0,point:[f,e],index:r})}this.rects=s,this.links=l,this.hLinks=c},isInArray:function(t,e){for(let i=0;i<t.length;i++)if(e===t[i])return!0;return!1}}}),X=Q,tt=(i("15c6"),Object(j["a"])(X,Y,Z,!1,null,"f66e6bda",null)),et=tt.exports,it=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"faceview"}},[i("div",{staticClass:"card"},[i("div",{staticClass:"card-header"},[i("div",{staticStyle:{float:"left","margin-right":"40px"}},[i("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Map View")]),i("el-switch",{staticStyle:{"padding-left":"10px"},attrs:{"active-color":"#007979","inactive-color":"#d0d0d0"},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}}),i("el-select",{staticStyle:{width:"70px","padding-left":"10px"},attrs:{filterable:"",placeholder:"Please select",size:"mini"},model:{value:t.number,callback:function(e){t.number=e},expression:"number"}},t._l(t.choice,(function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})})),1),i("el-input-number",{staticStyle:{width:"90px"},attrs:{min:1,max:3,label:"Entropy",size:"mini"},on:{change:t.handleChange},model:{value:t.entropy,callback:function(e){t.entropy=e},expression:"entropy"}})],1)]),t._m(0)])])},at=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"card-block",attrs:{id:"faceContainer"}},[i("div",{attrs:{id:"mapDiv"}})])}],rt=i("e11e"),nt=i.n(rt),ot=(i("845a"),i("a94e"),i("9186"),i("6bb3"),i("6cc5"),i("2573"),i("8243"),i("3ac1"),i("7319"),i("de44"),i("e5e0"),{name:"FaceView",components:{},data(){return{mode:!1,number:1,choice:[1,2,3,4],entropy:1,svg:null,trajNum:0,regionId:-1,regions:null,regions_coordinates:[[40.71106894,-74.00783088],[40.72511451,-73.99513351],[40.72527513,-73.98450652],[40.74062869,-73.99462444],[40.7645624,-73.9733893],[40.75485609,-73.9845724],[40.78309201,-73.97783401],[40.77836093,-73.95765082],[40.80537075,-73.95895236],[40.79544377,-73.94270366],[40.82346498,-73.94589541],[40.84669929,-73.93685292],[40.86588784,-73.92291179]],content:{},mymap:null,bounds:0,layerGroups:new nt.a.FeatureGroup,direction:[[0,1],[1,0],[-1,0],[0,-1],[-1,1],[1,-1],[1,1],[-1,-1]]}},props:["date","startTime","timeLength"],computed:{info(){const{startTime:t,timeLength:e,regionId:i}=this;return{startTime:t,timeLength:e,regionId:i}}},watch:{info(t){0!==this.timeLength&&V.getHighOrder(this.startTime,this.timeLength,this.regionId,this.date,t=>{this.content=t.data,this.$emit("conveyHighOrder",this.content),console.log(this.content),this.drawKelp()})},date(t){V.getRegionFlow(this.date,t=>{this.regions=t.data,this.$emit("conveyRegionFlow",this.regions),alert(this.date+" data is ready!")})},mode(t){if(this.mymap.remove(),this.mymap=this.init("mapDiv"),t)this.drawGlyph();else{this.drawSegmentation();let t=this.mymap;nt.a.svg({clickable:!0}).addTo(t);const e=d3.select(t.getPanes().overlayPane),i=e.select("svg").attr("pointer-events","auto");this.svg=i,this.drawKelp()}},number(t){this.$emit("conveyNumber",this.number)}},mounted:function(){this.mymap=this.init("mapDiv"),this.mymap.on("dragend",()=>{this.bounds=this.mymap.getBounds()}),this.drawSegmentation()},methods:{handleChange(){this.mymap.remove(),this.mymap=this.init("mapDiv"),this.mode?this.drawGlyph():this.drawSegmentation()},drawKelp(){let t=this,e=this.mymap,i=this.svg;i.selectAll(".glyph").remove(),i.selectAll(".highOrder").remove();let a=0,r=["#96CEB4","#EA99D5","#876445"],n=[15,10,5],o=3;for(let s in this.content){let l=[],c=[],d=[];if(a>=o)break;let h,u=s.split("_");for(let t=0;t<u.length-1;t++){let e={regionId:0,coordinate:[0,0],radius:0,color:"black"};h=this.regions_coordinates[Number(u[t])],e.regionId=Number(u[t]),e.coordinate=this.regions_coordinates[Number(u[t])],e.radius=n[a],e.color=r[a],l.push(e);let i={start:[0,0],end:[0,0],width:0,color:"black"},o={coordinate:[0,0],rotate:0,width:0,color:"black"};t<u.length-2&&(i.start=h,i.end=this.regions_coordinates[Number(u[t+1])],i.width=n[a],i.color=r[a],c.push(i),o.coordinate=[2*i.start[0]/3+i.end[0]/3,2*i.start[1]/3+i.end[1]/3],o.rotate=180*Math.atan2(i.end[1]-i.start[1],i.end[0]-i.start[0])/Math.PI,o.color=r[a],o.width=n[a],d.push(o))}for(let t=0;t<this.content[s].length;t++)if(0!==this.content[s][t]){let e={regionId:0,coordinate:[0,0],radius:0,color:"black"};e.regionId=t,e.coordinate=this.regions_coordinates[t],e.radius=n[a],e.color=r[a],l.push(e);let i={start:[0,0],end:[0,0],width:0,color:"black"};i.start=h,i.end=this.regions_coordinates[t],i.width=n[a],i.color=r[a],c.push(i);let o={coordinate:[0,0],rotate:0,width:0,color:"black"};o.coordinate=[2*i.start[0]/3+i.end[0]/3,2*i.start[1]/3+i.end[1]/3],o.rotate=180*Math.atan2(i.end[1]-i.start[1],i.end[0]-i.start[0])/Math.PI,o.color=r[a],o.width=n[a],d.push(o)}a++;const g=i.selectAll("whatever").data(l).enter().append("circle").attr("class","highOrder").attr("fill",t=>t.color).attr("stroke","black").attr("stroke-width",0).attr("cx",t=>e.latLngToLayerPoint(t.coordinate).x).attr("cy",t=>e.latLngToLayerPoint(t.coordinate).y).attr("r",t=>t.radius).on("click",e=>{t.$emit("conveyRegion",e.regionId),t.regionId=e.regionId,console.log(e.regionId)}).on("mouseover",(function(e){t.drawSingleGlyph(e.regionId,20,40)})).on("mouseout",(function(t){i.selectAll(".glyph").remove()})),p=i.selectAll("whatever").data(c).enter().append("line").attr("class","highOrder").attr("stroke",t=>t.color).attr("stroke-width",t=>.6*t.width).attr("x1",t=>e.latLngToLayerPoint(t.start).x).attr("y1",t=>e.latLngToLayerPoint(t.start).y).attr("x2",t=>e.latLngToLayerPoint(t.end).x).attr("y2",t=>e.latLngToLayerPoint(t.end).y),f=i.selectAll("whatever").data(d).enter().append("path").attr("class","highOrder").attr("d",d3.symbol().size(t=>10*t.width).type(d3.symbolTriangle)).attr("fill",t=>t.color).attr("transform",t=>"translate("+e.latLngToLayerPoint(t.coordinate).x+","+e.latLngToLayerPoint(t.coordinate).y+")rotate("+t.rotate+")"),y=t=>{g.attr("cx",t=>e.latLngToLayerPoint(t.coordinate).x).attr("cy",t=>e.latLngToLayerPoint(t.coordinate).y),p.attr("x1",t=>e.latLngToLayerPoint(t.start).x).attr("y1",t=>e.latLngToLayerPoint(t.start).y).attr("x2",t=>e.latLngToLayerPoint(t.end).x).attr("y2",t=>e.latLngToLayerPoint(t.end).y),f.attr("transform",t=>"translate("+e.latLngToLayerPoint(t.coordinate).x+","+e.latLngToLayerPoint(t.coordinate).y+")rotate("+t.rotate+")")};e.on("zoomend",t=>{let e=t.target.getZoom();y(e)})}},drawGlyph(){let t=this.mymap;nt.a.svg({clickable:!0}).addTo(t);const e=d3.select(t.getPanes().overlayPane),i=e.select("svg").attr("pointer-events","auto");this.svg=i;let a=this.regions_coordinates;for(let r=0;r<a.length;r++)this.drawSingleGlyph(r,10,20)},drawSingleGlyph(t,e,i){let a=this.regions_coordinates[t],r=this.regions[t],n=this.svg,o=this,s=this.mymap.latLngToLayerPoint(a),l=n.append("g").attr("class","glyph").attr("transform","translate("+s.x+","+s.y+")"),c=["#99CCCC","#FFCC99","#FFCCCC","#0099CC","#CC9999","#FF6666","#FFFF99","#CCCCFF","#CC9966","#CCCCCC"],d=d3.pie().value((function(t){return t})),h=d(r);l.selectAll("whatever").data(h).enter().append("path").attr("d",d3.arc().innerRadius(e).outerRadius(i)).attr("fill",(function(t){return c[t.index]})).attr("stroke","black").style("stroke-width","0.3px").style("opacity",1),l.append("circle").attr("class","circle").attr("r",e).attr("fill","white").attr("opacity",0).on("click",(function(){o.$emit("conveyRegion",t),o.regionId=t,console.log(t)}));const u=()=>{s=this.mymap.latLngToLayerPoint(a),l.attr("transform","translate("+s.x+","+s.y+")")};this.mymap.on("zoomend",t=>{u()})},drawSegmentation(){let t=this.mymap;V.getVanAreasMap(this.entropy,e=>{let i=e.data,a={Food:0,"Shop & Service":1,"Outdoors & Recreation":2,"Professional & Other Places":3,"Travel & Transport":4,"Nightlife Spot":5,"Arts & Entertainment":6,"College & University":7,Residence:8,Event:9};nt.a.geoJson(i,{style:function(t){let e=["#99CCCC","#FFCC99","#FFCCCC","#0099cc","#CC9999","#FF6666","#FFFF99","#CCCCFF","#CC9966","#CCCCCC","#666666","#99CC66","#CCCC99"];return{weight:.1,color:"black",fill:!0,fillColor:e[a[t.properties.category]],fillOpacity:1}}}).bindPopup((function(t){return"Region: "+t.feature.properties.region})).addTo(t)})},init(t){let e=new nt.a.map(t,{center:new nt.a.LatLng(40.7743528,-73.9079731),zoom:12,preferCanvas:!0});nt.a.tileLayer.provider("Esri.WorldGrayCanvas").addTo(e);return e}}}),st=ot,lt=(i("5409"),Object(j["a"])(st,it,at,!1,null,"faf87012",null)),ct=lt.exports,dt=i("21c6"),ht={name:"app",components:{VideoView:G,TextView:W,AudioView:et,FaceView:ct,FifthView:dt["default"]},data(){return{date:"",region:-1,info:{user_id:0,date:1977},startTime:0,timeLength:0,content:{},number:1,regionsFlow:null,dir:[],width:0,height:0,radius:0,type:["球墨铸铁管"],videoList:[],videoId:"simon_sinek_why_good_leaders_make_you_feel_safe",videoData:{},coords:[],peak:{},nodes:{}}},methods:{updateData(t){this.date=t},updateRegion(t){this.region=t},updateRegionFlow(t){this.regionsFlow=t},updateHighOrder(t){this.content=t},updateNumber(t){this.number=t},updateTime(t,e){this.timeLength=e,this.startTime=t},changemap(t){},change(t){this.nodes=t},initdraw(t,e){this.width=t,this.height=e},receiveFather(t,e){this.radius=t,this.type=e}},mounted:function(){console.log("d3: ",d3),console.log("$: ",$),console.log("_",_.partition([1,2,3,4],t=>t%2))}},ut=ht,gt=(i("034f"),Object(j["a"])(ut,o,s,!1,null,null,null)),pt=gt.exports,ft=(i("4989"),i("ab8b"),i("4bcc"),i("2ef0")),yt=i.n(ft),mt=i("5698"),vt=i("1157"),Ct=i.n(vt);window._=yt.a,window.d3=mt,window.$=Ct.a,a["default"].config.productionTip=!1,a["default"].use(n.a),new a["default"]({render:t=>t(pt)}).$mount("#app")},"57ad":function(t,e,i){"use strict";i("6981")},6981:function(t,e,i){},"85ec":function(t,e,i){},"9c4a":function(t,e,i){"use strict";var a=i("e5d2"),r=i.n(a);e["default"]=r.a},c4b3:function(t,e,i){"use strict";i("3756")},c876:function(t,e,i){},e5d2:function(t,e){},e7a4:function(t,e){},f827:function(t,e,i){},fdb8:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return r}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"fifthview"}},[i("div",{staticClass:"card"},[t._m(0),i("div",{staticClass:"card-block",attrs:{id:"fifthViewContainer"}},[i("div",{attrs:{id:"labelsContainer"}},[i("svg",{attrs:{id:"mysvg"}})])])])])},r=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"card-header"},[i("div",{staticStyle:{float:"left","margin-left":"10px","margin-top":"6px"}},[i("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Fifth View")])])])}]}});
//# sourceMappingURL=app.571d0cb5.js.map